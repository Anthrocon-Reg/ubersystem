{% extends "./preregistration/preregbase.html" %}
{% block title %}Preregistration{% endblock %}
{% block backlink %}{% endblock %}
{% block content %}

<script type="text/javascript">
function PopIt() { if($('.stripe_checkout_app').filter(":hidden").length){
        /* don't return anything */
        } else {
        return "You're not done registering! Please wait until you see the confirmation page.";
    } }
function UnPopIt()  { /* nothing to return */ }

jQuery(document).ready(function() {
window.onbeforeunload = PopIt;
jQuery("a").click(function(){ window.onbeforeunload = UnPopIt; });
$(".buttonsView").children().click(function(){ window.onbeforeunload = UnPopIt; });
});
</script>

<div class="masthead">
</div>

<div class="panel panel-default">
<div class="row bs-wizard" style="border-bottom:0;border-top:0;">   
    <div class="col-xs-4 bs-wizard-step complete">
      <div class="text-center bs-wizard-stepnum">Step 1</div>
      <div class="progress"><div class="progress-bar"></div></div>
      <a class="bs-wizard-dot"></a>
      <div class="bs-wizard-info text-center">Enter Info</div>
    </div> 
    <div class="col-xs-4 bs-wizard-step active">
      <div class="text-center bs-wizard-stepnum">Step 2</div>
      <div class="progress"><div class="progress-bar"></div></div>
      <a class="bs-wizard-dot"></a>
      <div class="bs-wizard-info text-center">Review &amp; Pay</div>
    </div>
    <div class="col-xs-4 bs-wizard-step disabled">
      <div class="text-center bs-wizard-stepnum">Step 3</div>
      <div class="progress"><div class="progress-bar"></div></div>
      <a class="bs-wizard-dot"></a>
      <div class="bs-wizard-info text-center">Done</div>
    </div>
</div>

<div class="panel"><table class="charge table footable" data-sort="false">
<thead><tr>
    <th>Preregistration</th>
    <th data-hide="phone" data-sort-ignore="true">Details</th>
    <th data-type="numeric">Price</th>
    <th data-sort-ignore="true"></th>
</tr></thead>
{% for attendee in charge.attendees %}
    <tr>
        <td>{{ attendee.full_name }}</td>
        <td>
            <ul style="padding-left:15px">
                <li>Membership for Anthrocon</li>
                {% for swag in attendee.donation_swag %}
                    <li>{{ swag }}</li>
                {% endfor %}
            </ul>
        </td>
        <td>${{ attendee.total_cost }}</td>
        <td>
            <a href="form?edit_id={{ attendee.id }}">Edit</a> /
            <a href="delete?id={{ attendee.id }}">Delete</a>
        </td>
     </tr>
{% endfor %}
{% for group in charge.groups %}
    <tr>
        <td>{{ group.name }}</td>
        <td>
            <ul>
                <li>{{ group.badges }} badges</li>
                {% for swag in group.attendees.0.donation_swag %}
                    <li>{{ swag }}</li>
                {% endfor %}
            </ul>
        </td>
        <td>${{ group.default_cost }}</td>
        <td>
            <a href="form?edit_id={{ group.id }}">Edit</a> /
            <a href="delete?id={{ group.id }}">Delete</a>
        </td>
    </tr>
{% endfor %}

{% if charge.targets|length > 1 %}
<tfoot>
    <tr>
        <th></th>
        <th style="text-align:right;"><i>Total:</i></th>
        <th><b>${{ charge.dollar_amount }}</b></th>
        <th></th>
    </tr>
</tfoot>

</table></div>
{% endif %}

<div class="row">
<div class="row">
<div>
    <div class="text-center">
        {% if AT_THE_CON %}
            <a href="index?payment_method={{ CASH }}"><button class="btn btn-success">Pay with Cash</button></a>
            {% stripe_form take_payment charge %}
            <a href="index?payment_method={{ SQUARE }}"><button class="btn btn-info">Pay with Card at the Desk</button></a>
        {% else %}
            {% stripe_form take_payment charge %}
        {% endif %}
    </div>
    <div class="text-center">
        <br/>or<br/><br/>
        <a href="form"><button class="btn btn-default">Add Another Person</button></a>
    </div>
</div>
</div>
</div>

{% include "preregistration/disclaimers.html" %}
</div>
{% endblock %}
