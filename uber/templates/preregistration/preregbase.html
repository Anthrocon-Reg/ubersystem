{% extends "base.html" %}
{% block sectionStyle %}
    <!-- <link rel="stylesheet" type="text/css" href="../static_views/prereg.css" /> -->
{% endblock %}
{% block backlink %}


{% endblock %}
{% block header %}
<link href="../static/themes/prereg.css" rel="stylesheet">
<script type="text/javascript">
    var checkCap = function () {
        $.getJSON('check_prereg', function(check) {
            if (check.force_refresh) {
                location.reload(); // Reload the page to prevent registering after reg is closed
            }
        });
    };
    setInterval(checkCap, 1000 * 1 * 15);

$(document).ready(function() {
    {% if COLLECT_FULL_ADDRESS %}
    if($("input[name='international']")) {
        $("#international").hide();
        setInternational();
    }
    {% endif %}

    // This section populates the "badge" choices if they are drawn on the page
    var sponsor_addon = 50;
    var super_sponsor_addon = 195;

    if($('#featured1_select')) {
        var sponsor_badge_price = {{ BADGE_PRICE }} + sponsor_addon
        $('#featured1_select').html('<h4 class="list-group-item-heading">Sponsor: $'+sponsor_badge_price+'</h4>{% if BEFORE_FIRST_PRICE_BUMP %}($105 after Jan 1)<br/>{% endif %}<p class="list-group-item-text">Donate extra and get perks on top of an attending membership.</p>');
    }

    if($('#featured2_select')) {
        var super_sponsor_badge_price = {{ BADGE_PRICE }} + super_sponsor_addon
        $('#featured2_select').html('<h4 class="list-group-item-heading">Super Sponsor: $'+super_sponsor_badge_price+'</h4>{% if BEFORE_FIRST_PRICE_BUMP %}($250 after Jan 1)<br/>{% endif %}<p class="list-group-item-text">The most generous option - get even more great perks!</p>');
    }

    // Sets the badge box to correspond to the the session's kick-in level
    // If the attendee has already paid, they cannot downgrade their badge
    if ($.val('amount_extra') === sponsor_addon) {
        if ({{ attendee.amount_paid }} >= sponsor_addon) {
            $("#attendee_select").addClass("disabled");
            $("#attendee_select").prop("onclick",null);
        }
        setBadge('Featured1');
    } else if ($.val('amount_extra') === super_sponsor_addon) {
        if ({{ attendee.amount_paid }} >= super_sponsor_addon) {
            $("#attendee_select").addClass("disabled");
            $("#featured1_select").addClass("disabled");
            $("#attendee_select").prop("onclick",null);
            $("#featured1_select").prop("onclick",null);
        }
        setBadge('Featured2');
    } else {
        setBadge('Attendee');
    }
})

function setInternational() {
    countryName = $("input[name='country']").val();

    if(countryName == "USA" || countryName == "US" || countryName == "United States") {
        $("input[name='international']").prop('checked', false);
    } else {
        $("input[name='international']").prop('checked', true);
    }
}

function setBadge(badgeType) {
    var sponsor_addon = 50;
    var super_sponsor_addon = 195;

    $(".badge_type_selector").removeClass("active");
    $(".group_fields").addClass("hide");
    if (badgeType == 'Attendee') {
        if ("input[name='badge_type']") { $("input[name='badge_type']").val("{{ ATTENDEE_BADGE }}"); }
        $("#attendee_select").addClass("active");
        $.field("amount_extra").val('0').trigger("change");
    }
    if (badgeType == 'Group') {
        if ("input[name='badge_type']") { $("input[name='badge_type']").val("{{ PSEUDO_GROUP_BADGE }}"); }
        $(".group_fields").removeClass("hide");
        $("#group_select").addClass("active");
        $.field("amount_extra").val('0').trigger("change");
    }
    if (badgeType == 'Featured1') {
        if ("input[name='badge_type']") { $("input[name='badge_type']").val("{{ ATTENDEE_BADGE }}"); }
        $("#featured1_select").addClass("active");
        $.field("amount_extra").val(sponsor_addon).trigger("change");
    }
    if (badgeType == 'Featured2') {
        if ("input[name='badge_type']") { $("input[name='badge_type']").val("{{ ATTENDEE_BADGE }}"); }
        $("#featured2_select").addClass("active");
        $.field("amount_extra").val(super_sponsor_addon).trigger("change");
    }
}
</script>
{% endblock header %}